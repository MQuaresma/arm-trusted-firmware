#include <assert.h>
#include <string.h>

#include <plat/common/platform.h>
#include <platform_def.h>

static unsigned char dc_blob[] = \
    "\x30\x82\x01\xde\x30\x82\x01\x81\xa0\x03\x02\x01\x02\x02" \
    "\x09\x00\xe5\x62\x25\x76\xa3\xf7\x49\xec\x30\x0c\x06\x08" \
    "\x2a\x86\x48\xce\x3d\x04\x03\x02\x05\x00\x30\x36\x31\x0b" \
    "\x30\x09\x06\x03\x55\x04\x06\x13\x02\x50\x54\x31\x0f\x30" \
    "\x0d\x06\x03\x55\x04\x0a\x0c\x06\x48\x61\x73\x6c\x61\x62" \
    "\x31\x16\x30\x14\x06\x03\x55\x04\x03\x0c\x0d\x48\x61\x73" \
    "\x6c\x61\x62\x20\x44\x65\x76\x69\x63\x65\x30\x1e\x17\x0d" \
    "\x31\x39\x31\x32\x33\x31\x32\x33\x35\x39\x35\x39\x5a\x17" \
    "\x0d\x32\x31\x31\x32\x33\x31\x32\x33\x35\x39\x35\x39\x5a" \
    "\x30\x36\x31\x0b\x30\x09\x06\x03\x55\x04\x06\x13\x02\x50" \
    "\x54\x31\x0f\x30\x0d\x06\x03\x55\x04\x0a\x0c\x06\x48\x61" \
    "\x73\x6c\x61\x62\x31\x16\x30\x14\x06\x03\x55\x04\x03\x0c" \
    "\x0d\x48\x61\x73\x6c\x61\x62\x20\x44\x65\x76\x69\x63\x65" \
    "\x30\x59\x30\x13\x06\x07\x2a\x86\x48\xce\x3d\x02\x01\x06" \
    "\x08\x2a\x86\x48\xce\x3d\x03\x01\x07\x03\x42\x00\x04\xd0" \
    "\xbc\xad\xbc\x9a\x06\xb5\xa5\x84\x3e\xf8\xd0\xbe\x05\xef" \
    "\x48\x6a\xf3\x23\x79\x6e\x2b\x85\x92\x63\x38\x74\x2f\xa7" \
    "\xde\xa0\x1d\xc2\xab\x27\x7d\xab\x29\x7e\x14\x9f\x4c\x43" \
    "\x32\x14\xb6\xc4\xf6\xeb\x06\x55\x3b\x27\xe7\x9c\x30\x2f" \
    "\x3b\xdb\xef\xb9\xf9\x47\x1e\xa3\x76\x30\x74\x30\x0f\x06" \
    "\x03\x55\x1d\x13\x04\x08\x30\x06\x01\x01\xff\x02\x01\x00" \
    "\x30\x1d\x06\x03\x55\x1d\x0e\x04\x16\x04\x14\x40\x1a\x30" \
    "\x81\x5e\x41\xff\xb2\x46\x72\x79\xde\x0f\xf5\x45\x2f\x09" \
    "\x3d\x0a\xa4\x30\x1f\x06\x03\x55\x1d\x23\x04\x18\x30\x16" \
    "\x80\x14\x40\x1a\x30\x81\x5e\x41\xff\xb2\x46\x72\x79\xde" \
    "\x0f\xf5\x45\x2f\x09\x3d\x0a\xa4\x30\x0e\x06\x03\x55\x1d" \
    "\x0f\x01\x01\xff\x04\x04\x03\x02\x06\xc0\x30\x11\x06\x09" \
    "\x60\x86\x48\x01\x86\xf8\x42\x01\x01\x04\x04\x03\x02\x04" \
    "\x10\x30\x0c\x06\x08\x2a\x86\x48\xce\x3d\x04\x03\x02\x05" \
    "\x00\x03\x49\x00\x30\x46\x02\x21\x00\x9b\xf1\x4c\xdc\x4b" \
    "\x54\xde\x66\xa5\xfd\x9f\x27\x78\xd4\x73\xf9\xb7\xc0\x48" \
    "\x57\x05\xbb\x5f\xae\x94\xcc\x6b\x46\x1c\x23\x8c\xdf\x02" \
    "\x21\x00\xc0\x70\x61\xb3\x04\x1a\x53\x48\x1b\x80\xac\x86" \
    "\xaf\x47\xfa\x9c\xdd\xc8\xdd\x75\x9d\xa1\x63\x35\x26\x81" \
    "\x9f\x3e\x07\x92\xea\x4e";

static unsigned char ak_blob[] = \
    "\x0e\xaa\x9c\xb6\x09\x1b\xda\x28\xba\xee\xf0\x3b\x55\x1c" \
    "\xbe\x0e\x65\xc1\xbb\x55\x3a\xec\x15\x11\x22\xec\x05\x89" \
    "\xcf\xbd\xcd\x94\xd0\xbc\xad\xbc\x9a\x06\xb5\xa5\x84\x3e" \
    "\xf8\xd0\xbe\x05\xef\x48\x6a\xf3\x23\x79\x6e\x2b\x85\x92" \
    "\x63\x38\x74\x2f\xa7\xde\xa0\x1d\xc2\xab\x27\x7d\xab\x29" \
    "\x7e\x14\x9f\x4c\x43\x32\x14\xb6\xc4\xf6\xeb\x06\x55\x3b" \
    "\x27\xe7\x9c\x30\x2f\x3b\xdb\xef\xb9\xf9\x47\x1e";

static unsigned char dck_blob[] = \
    "\x30\x82\x01\xde\x30\x82\x01\x81\xa0\x03\x02\x01\x02\x02" \
    "\x09\x00\xe5\x62\x25\x76\xa3\xf7\x49\xec\x30\x0c\x06\x08" \
    "\x2a\x86\x48\xce\x3d\x04\x03\x02\x05\x00\x30\x36\x31\x0b" \
    "\x30\x09\x06\x03\x55\x04\x06\x13\x02\x50\x54\x31\x0f\x30" \
    "\x0d\x06\x03\x55\x04\x0a\x0c\x06\x48\x61\x73\x6c\x61\x62" \
    "\x31\x16\x30\x14\x06\x03\x55\x04\x03\x0c\x0d\x48\x61\x73" \
    "\x6c\x61\x62\x20\x44\x65\x76\x69\x63\x65\x30\x1e\x17\x0d" \
    "\x31\x39\x31\x32\x33\x31\x32\x33\x35\x39\x35\x39\x5a\x17" \
    "\x0d\x32\x31\x31\x32\x33\x31\x32\x33\x35\x39\x35\x39\x5a" \
    "\x30\x36\x31\x0b\x30\x09\x06\x03\x55\x04\x06\x13\x02\x50" \
    "\x54\x31\x0f\x30\x0d\x06\x03\x55\x04\x0a\x0c\x06\x48\x61" \
    "\x73\x6c\x61\x62\x31\x16\x30\x14\x06\x03\x55\x04\x03\x0c" \
    "\x0d\x48\x61\x73\x6c\x61\x62\x20\x44\x65\x76\x69\x63\x65" \
    "\x30\x59\x30\x13\x06\x07\x2a\x86\x48\xce\x3d\x02\x01\x06" \
    "\x08\x2a\x86\x48\xce\x3d\x03\x01\x07\x03\x42\x00\x04\xd0" \
    "\xbc\xad\xbc\x9a\x06\xb5\xa5\x84\x3e\xf8\xd0\xbe\x05\xef" \
    "\x48\x6a\xf3\x23\x79\x6e\x2b\x85\x92\x63\x38\x74\x2f\xa7" \
    "\xde\xa0\x1d\xc2\xab\x27\x7d\xab\x29\x7e\x14\x9f\x4c\x43" \
    "\x32\x14\xb6\xc4\xf6\xeb\x06\x55\x3b\x27\xe7\x9c\x30\x2f" \
    "\x3b\xdb\xef\xb9\xf9\x47\x1e\xa3\x76\x30\x74\x30\x0f\x06" \
    "\x03\x55\x1d\x13\x04\x08\x30\x06\x01\x01\xff\x02\x01\x00" \
    "\x30\x1d\x06\x03\x55\x1d\x0e\x04\x16\x04\x14\x40\x1a\x30" \
    "\x81\x5e\x41\xff\xb2\x46\x72\x79\xde\x0f\xf5\x45\x2f\x09" \
    "\x3d\x0a\xa4\x30\x1f\x06\x03\x55\x1d\x23\x04\x18\x30\x16" \
    "\x80\x14\x40\x1a\x30\x81\x5e\x41\xff\xb2\x46\x72\x79\xde" \
    "\x0f\xf5\x45\x2f\x09\x3d\x0a\xa4\x30\x0e\x06\x03\x55\x1d" \
    "\x0f\x01\x01\xff\x04\x04\x03\x02\x06\xc0\x30\x11\x06\x09" \
    "\x60\x86\x48\x01\x86\xf8\x42\x01\x01\x04\x04\x03\x02\x04" \
    "\x10\x30\x0c\x06\x08\x2a\x86\x48\xce\x3d\x04\x03\x02\x05" \
    "\x00\x03\x49\x00\x30\x46\x02\x21\x00\x9b\xf1\x4c\xdc\x4b" \
    "\x54\xde\x66\xa5\xfd\x9f\x27\x78\xd4\x73\xf9\xb7\xc0\x48" \
    "\x57\x05\xbb\x5f\xae\x94\xcc\x6b\x46\x1c\x23\x8c\xdf\x02" \
    "\x21\x00\xc0\x70\x61\xb3\x04\x1a\x53\x48\x1b\x80\xac\x86" \
    "\xaf\x47\xfa\x9c\xdd\xc8\xdd\x75\x9d\xa1\x63\x35\x26\x81" \
    "\x9f\x3e\x07\x92\xea\x4e\x0e\xaa\x9c\xb6\x09\x1b\xda\x28" \
    "\xba\xee\xf0\x3b\x55\x1c\xbe\x0e\x65\xc1\xbb\x55\x3a\xec" \
    "\x15\x11\x22\xec\x05\x89\xcf\xbd\xcd\x94\xd0\xbc\xad\xbc" \
    "\x9a\x06\xb5\xa5\x84\x3e\xf8\xd0\xbe\x05\xef\x48\x6a\xf3" \
    "\x23\x79\x6e\x2b\x85\x92\x63\x38\x74\x2f\xa7\xde\xa0\x1d" \
    "\xc2\xab\x27\x7d\xab\x29\x7e\x14\x9f\x4c\x43\x32\x14\xb6" \
    "\xc4\xf6\xeb\x06\x55\x3b\x27\xe7\x9c\x30\x2f\x3b\xdb\xef" \
    "\xb9\xf9\x47\x1e";


/* 
 * Return the device certificate, used for attestation, in DER format
 */
int plat_get_device_cert(void **dc_ptr, unsigned int *dc_len){
    assert(dc_ptr != NULL);
    assert(dc_len != NULL);

    *dc_ptr = (void *)dc_blob;
    *dc_len = sizeof(dc_blob) - 1;

    return 0;
}

int plat_get_acc_key(void **ak_ptr, unsigned int *ak_len){
    assert(ak_ptr != NULL);
    assert(ak_len != NULL);

    *ak_ptr = (void *)ak_blob;
    *ak_len = sizeof(ak_blob) - 1;

    return 0;
}


int plat_get_dck_blob(void **dck_ptr, unsigned int *dc_len, unsigned int *ak_len){
    assert(dck_ptr != NULL);
    assert(dc_len != NULL);
    assert(ak_len != NULL);

    *dck_ptr = (void *)dck_blob;
    *dc_len = sizeof(dc_blob) - 1;
    *ak_len = sizeof(ak_blob) - 1;

    return 0;
}


/* TODO
 * Update the device certificate used for attestation
 */
int plat_update_device_cert(void *hwkey, void *new_cert, unsigned int *cert_len){
    //Not implemented
    return 0;
}


