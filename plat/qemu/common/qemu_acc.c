#include <assert.h>
#include <string.h>

#include <plat/common/platform.h>
#include <platform_def.h>

static unsigned char dc_der[] = \
    "\x30\x82\x01\xf0\x30\x82\x01\x50\xa0\x03\x02\x01\x02\x02" \
    "\x01\x01\x30\x0c\x06\x08\x2a\x86\x48\xce\x3d\x04\x03\x02" \
    "\x05\x00\x30\x11\x31\x0f\x30\x0d\x06\x03\x55\x04\x03\x0c" \
    "\x06\x48\x61\x73\x6c\x61\x62\x30\x1e\x17\x0d\x32\x30\x30" \
    "\x34\x31\x36\x31\x37\x31\x38\x30\x39\x5a\x17\x0d\x32\x30" \
    "\x30\x37\x31\x35\x31\x37\x31\x38\x30\x39\x5a\x30\x18\x31" \
    "\x16\x30\x14\x06\x03\x55\x04\x03\x0c\x0d\x48\x61\x73\x6c" \
    "\x61\x62\x20\x44\x65\x76\x69\x63\x65\x30\x81\x9b\x30\x10" \
    "\x06\x07\x2a\x86\x48\xce\x3d\x02\x01\x06\x05\x2b\x81\x04" \
    "\x00\x23\x03\x81\x86\x00\x04\x00\x14\x74\x91\x92\x51\x70" \
    "\xf5\xb6\x00\x5d\x40\x8f\x65\x54\xd9\x56\x9c\x74\xef\xd2" \
    "\xb1\xe5\x01\xd5\xaf\xe0\xd1\xe4\x38\x22\xdb\x64\x0c\xc9" \
    "\x79\xfb\x88\xab\x55\x24\x5f\x48\xe4\xbe\x21\x53\xf2\x1d" \
    "\x86\x91\x67\x24\x9c\xd9\xc0\x2f\x00\xd2\x82\x0f\x7d\xd7" \
    "\xf5\x40\xcc\x00\x14\x37\xb8\x7e\x55\xad\x68\x9c\x16\xec" \
    "\x93\x82\xa6\x13\x6a\xd4\xd3\x45\x45\x72\x0d\xa2\x9d\x43" \
    "\xb1\xb9\xbb\x94\x93\x86\xad\x3b\x3b\xa1\x0d\xb5\x93\xca" \
    "\xaa\xf0\x9d\x0e\xe3\x7a\x58\xbb\x2f\x7c\x53\x8a\x55\xfd" \
    "\x9e\x03\x54\x4d\x92\x82\xb0\xb2\x4f\x46\x32\xf7\x84\xa3" \
    "\x4d\x30\x4b\x30\x1f\x06\x03\x55\x1d\x23\x04\x18\x30\x16" \
    "\x80\x14\xaa\xbe\x15\x4b\x13\x69\x41\xa0\x8c\x39\x67\xbb" \
    "\xab\x87\xd7\x71\xa8\xca\xf8\x57\x30\x1d\x06\x03\x55\x1d" \
    "\x0e\x04\x16\x04\x14\xca\xc7\x7b\x38\x9f\x21\xee\xe8\x8c" \
    "\x79\x32\x61\xa8\xde\x96\xaf\xb8\x47\xe7\xb1\x30\x09\x06" \
    "\x03\x55\x1d\x13\x04\x02\x30\x00\x30\x0c\x06\x08\x2a\x86" \
    "\x48\xce\x3d\x04\x03\x02\x05\x00\x03\x81\x8b\x00\x30\x81" \
    "\x87\x02\x41\x18\x12\x07\x83\x2c\xca\xd5\x77\x90\x94\x0e" \
    "\x19\x5b\x18\xbb\x1d\x8b\x0d\xf9\x0b\xae\x47\xdb\xe0\x56" \
    "\x39\xf2\xff\x96\x80\x90\x05\xd8\x2d\xe7\x07\x9b\xa1\xce" \
    "\x4a\x86\x73\x53\xb3\x16\xf1\xa7\x0d\x7e\x4e\x18\xa9\xc9" \
    "\x5d\xc8\x3b\x29\xd8\x80\x4a\x57\x1c\x11\x61\x02\x02\x42" \
    "\x00\x85\x8e\x58\xb3\x19\xbf\xf0\x0b\xab\x2b\x2b\xbf\xb2" \
    "\x14\xbb\xd7\xb2\xdc\xd6\x9f\x36\xdf\x9e\x99\x91\x0c\x27" \
    "\xdf\x94\x51\xa8\x1e\x2b\x21\xe3\xac\x31\xc7\xfc\x6d\x28" \
    "\xc7\xd7\xb6\xdd\xbd\x5e\x4d\x3b\x83\x24\xb0\x33\xf2\xb0" \
    "\x40\x78\xef\xd3\x1c\xdb\x47\x9e\x7d\x59";

static unsigned char ak_blob[] = \
    "\xa9\x94\xbc\x1e\x73\xb9\xc9\x4d\xa1\x7a\x9e\x5a\x70\x56" \
    "\x64\x7f\x9e\x5f\x92\x2f\x57\xbc\x67\x18\xc5\xa9\x15\x75" \
    "\x4f\xe6\x55\x64\xc9\xc3\x66\x16\x72\xf2\xa4\x31\x08\x02" \
    "\x89\x62\x94\xac\x88\xfd\x73\xc1\x1d\x43\x4e\xf5\x95\x78" \
    "\xd2\xc7\x64\xba\x66\x3e\x93\x66\x28\x62";

static unsigned char dck_blob[] = \
    "\x30\x82\x01\xf0\x30\x82\x01\x50\xa0\x03\x02\x01\x02\x02" \
    "\x01\x01\x30\x0c\x06\x08\x2a\x86\x48\xce\x3d\x04\x03\x02" \
    "\x05\x00\x30\x11\x31\x0f\x30\x0d\x06\x03\x55\x04\x03\x0c" \
    "\x06\x48\x61\x73\x6c\x61\x62\x30\x1e\x17\x0d\x32\x30\x30" \
    "\x34\x31\x36\x31\x37\x31\x38\x30\x39\x5a\x17\x0d\x32\x30" \
    "\x30\x37\x31\x35\x31\x37\x31\x38\x30\x39\x5a\x30\x18\x31" \
    "\x16\x30\x14\x06\x03\x55\x04\x03\x0c\x0d\x48\x61\x73\x6c" \
    "\x61\x62\x20\x44\x65\x76\x69\x63\x65\x30\x81\x9b\x30\x10" \
    "\x06\x07\x2a\x86\x48\xce\x3d\x02\x01\x06\x05\x2b\x81\x04" \
    "\x00\x23\x03\x81\x86\x00\x04\x00\x14\x74\x91\x92\x51\x70" \
    "\xf5\xb6\x00\x5d\x40\x8f\x65\x54\xd9\x56\x9c\x74\xef\xd2" \
    "\xb1\xe5\x01\xd5\xaf\xe0\xd1\xe4\x38\x22\xdb\x64\x0c\xc9" \
    "\x79\xfb\x88\xab\x55\x24\x5f\x48\xe4\xbe\x21\x53\xf2\x1d" \
    "\x86\x91\x67\x24\x9c\xd9\xc0\x2f\x00\xd2\x82\x0f\x7d\xd7" \
    "\xf5\x40\xcc\x00\x14\x37\xb8\x7e\x55\xad\x68\x9c\x16\xec" \
    "\x93\x82\xa6\x13\x6a\xd4\xd3\x45\x45\x72\x0d\xa2\x9d\x43" \
    "\xb1\xb9\xbb\x94\x93\x86\xad\x3b\x3b\xa1\x0d\xb5\x93\xca" \
    "\xaa\xf0\x9d\x0e\xe3\x7a\x58\xbb\x2f\x7c\x53\x8a\x55\xfd" \
    "\x9e\x03\x54\x4d\x92\x82\xb0\xb2\x4f\x46\x32\xf7\x84\xa3" \
    "\x4d\x30\x4b\x30\x1f\x06\x03\x55\x1d\x23\x04\x18\x30\x16" \
    "\x80\x14\xaa\xbe\x15\x4b\x13\x69\x41\xa0\x8c\x39\x67\xbb" \
    "\xab\x87\xd7\x71\xa8\xca\xf8\x57\x30\x1d\x06\x03\x55\x1d" \
    "\x0e\x04\x16\x04\x14\xca\xc7\x7b\x38\x9f\x21\xee\xe8\x8c" \
    "\x79\x32\x61\xa8\xde\x96\xaf\xb8\x47\xe7\xb1\x30\x09\x06" \
    "\x03\x55\x1d\x13\x04\x02\x30\x00\x30\x0c\x06\x08\x2a\x86" \
    "\x48\xce\x3d\x04\x03\x02\x05\x00\x03\x81\x8b\x00\x30\x81" \
    "\x87\x02\x41\x18\x12\x07\x83\x2c\xca\xd5\x77\x90\x94\x0e" \
    "\x19\x5b\x18\xbb\x1d\x8b\x0d\xf9\x0b\xae\x47\xdb\xe0\x56" \
    "\x39\xf2\xff\x96\x80\x90\x05\xd8\x2d\xe7\x07\x9b\xa1\xce" \
    "\x4a\x86\x73\x53\xb3\x16\xf1\xa7\x0d\x7e\x4e\x18\xa9\xc9" \
    "\x5d\xc8\x3b\x29\xd8\x80\x4a\x57\x1c\x11\x61\x02\x02\x42" \
    "\x00\x85\x8e\x58\xb3\x19\xbf\xf0\x0b\xab\x2b\x2b\xbf\xb2" \
    "\x14\xbb\xd7\xb2\xdc\xd6\x9f\x36\xdf\x9e\x99\x91\x0c\x27" \
    "\xdf\x94\x51\xa8\x1e\x2b\x21\xe3\xac\x31\xc7\xfc\x6d\x28" \
    "\xc7\xd7\xb6\xdd\xbd\x5e\x4d\x3b\x83\x24\xb0\x33\xf2\xb0" \
    "\x40\x78\xef\xd3\x1c\xdb\x47\x9e\x7d\x59\xa9\x94\xbc\x1e" \
    "\x73\xb9\xc9\x4d\xa1\x7a\x9e\x5a\x70\x56\x64\x7f\x9e\x5f" \
    "\x92\x2f\x57\xbc\x67\x18\xc5\xa9\x15\x75\x4f\xe6\x55\x64" \
    "\xc9\xc3\x66\x16\x72\xf2\xa4\x31\x08\x02\x89\x62\x94\xac" \
    "\x88\xfd\x73\xc1\x1d\x43\x4e\xf5\x95\x78\xd2\xc7\x64\xba" \
    "\x66\x3e\x93\x66\x28\x62";

/* 
 * Return the device certificate, used for attestation, in DER format
 */
int plat_get_device_cert(void **dc_ptr, unsigned int *dc_len){
    assert(dc_ptr != NULL);
    assert(dc_len != NULL);

    *dc_ptr = (void *)dc_der;
	*dc_len = sizeof(dc_der) - 1;

    return 0;
}

int plat_get_acc_key(void **ak_ptr, unsigned int *ak_len){
	assert(ak_ptr != NULL);
	assert(ak_len != NULL);

	*ak_ptr = (void *)ak_blob;
	*ak_len = sizeof(ak_blob) - 1;

	return 0;
}


int plat_get_dck_blob(void **dck_ptr, unsigned int *dc_len, unsigned int *ak_len){
    assert(dck_ptr != NULL);
    assert(dc_len != NULL);
	assert(ak_len != NULL);

    *dck_ptr = (void *)dck_blob;
	*dc_len = sizeof(dc_der) - 1;
	*ak_len = sizeof(ak_blob) - 1;

    return 0;
}


/* TODO
 * Update the device certificate used for attestation
 */
int plat_update_device_cert(void *hwkey, void *new_cert, unsigned int *cert_len){
    //Not implemented
    return 0;
}


