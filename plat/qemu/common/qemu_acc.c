#include <assert.h>
#include <string.h>

#include <plat/common/platform.h>
#include <platform_def.h>

static unsigned char dc_der[] = \
    "\x30\x82\x01\xdd\x30\x82\x01\x81\xa0\x03\x02\x01\x02\x02" \
    "\x09\x00\x8a\x06\x54\x9c\x7a\xa7\xc3\x44\x30\x0c\x06\x08" \
    "\x2a\x86\x48\xce\x3d\x04\x03\x02\x05\x00\x30\x36\x31\x0b" \
    "\x30\x09\x06\x03\x55\x04\x06\x13\x02\x50\x54\x31\x0f\x30" \
    "\x0d\x06\x03\x55\x04\x0a\x0c\x06\x48\x61\x73\x6c\x61\x62" \
    "\x31\x16\x30\x14\x06\x03\x55\x04\x03\x0c\x0d\x48\x61\x73" \
    "\x6c\x61\x62\x20\x44\x65\x76\x69\x63\x65\x30\x1e\x17\x0d" \
    "\x31\x39\x31\x32\x33\x31\x32\x33\x35\x39\x35\x39\x5a\x17" \
    "\x0d\x32\x31\x31\x32\x33\x31\x32\x33\x35\x39\x35\x39\x5a" \
    "\x30\x36\x31\x0b\x30\x09\x06\x03\x55\x04\x06\x13\x02\x50" \
    "\x54\x31\x0f\x30\x0d\x06\x03\x55\x04\x0a\x0c\x06\x48\x61" \
    "\x73\x6c\x61\x62\x31\x16\x30\x14\x06\x03\x55\x04\x03\x0c" \
    "\x0d\x48\x61\x73\x6c\x61\x62\x20\x44\x65\x76\x69\x63\x65" \
    "\x30\x59\x30\x13\x06\x07\x2a\x86\x48\xce\x3d\x02\x01\x06" \
    "\x08\x2a\x86\x48\xce\x3d\x03\x01\x07\x03\x42\x00\x04\x9f" \
    "\x1d\x11\x98\xbe\xd9\x73\x6f\x5f\xe9\x2e\xde\x70\x39\x52" \
    "\x5a\xc8\x86\xaa\xc1\x2e\xc1\x99\xcc\x2e\x11\x78\x8a\xc1" \
    "\x7a\xcb\xad\xfd\x45\x94\xdd\x3a\x35\x49\xc0\x4c\x39\x49" \
    "\x11\x37\xf8\x99\xe5\x47\x11\xd7\xf7\x62\x33\xab\xcd\x7c" \
    "\x17\xa1\x18\x1b\x22\x8a\xb2\xa3\x76\x30\x74\x30\x0f\x06" \
    "\x03\x55\x1d\x13\x04\x08\x30\x06\x01\x01\xff\x02\x01\x00" \
    "\x30\x1d\x06\x03\x55\x1d\x0e\x04\x16\x04\x14\xea\x76\xd6" \
    "\xca\xe3\x8e\xd8\x1a\xa9\xae\x3b\xc9\x0c\x7b\x7a\x6b\xe6" \
    "\xfc\x14\x92\x30\x1f\x06\x03\x55\x1d\x23\x04\x18\x30\x16" \
    "\x80\x14\xea\x76\xd6\xca\xe3\x8e\xd8\x1a\xa9\xae\x3b\xc9" \
    "\x0c\x7b\x7a\x6b\xe6\xfc\x14\x92\x30\x0e\x06\x03\x55\x1d" \
    "\x0f\x01\x01\xff\x04\x04\x03\x02\x06\xc0\x30\x11\x06\x09" \
    "\x60\x86\x48\x01\x86\xf8\x42\x01\x01\x04\x04\x03\x02\x04" \
    "\x10\x30\x0c\x06\x08\x2a\x86\x48\xce\x3d\x04\x03\x02\x05" \
    "\x00\x03\x48\x00\x30\x45\x02\x21\x00\x9f\x81\x08\x21\x21" \
    "\x23\x3a\x35\x41\x9b\xc9\xa5\x12\x90\xc7\xb7\xdb\xd5\x4b" \
    "\x49\x45\x14\x8c\x57\x52\x1d\x20\x73\x7e\x30\xd8\x94\x02" \
    "\x20\x21\x25\x12\xae\x72\xf6\x1c\x8b\xf5\xd2\x1f\xb6\x5a" \
    "\x4e\x83\xde\xd3\x90\x82\xb3\xb9\x1a\x12\x1c\x5a\x64\xe9" \
    "\x4b\x4f\x5d\x51\x0c";

static unsigned char ak_blob[] = \
	"\x6c\x2e\x23\x72\xc8\xac\xec\x54\x1e\xba\xe5\xa2\x75\x88" \
    "\x13\x30\xb7\x50\x0d\x2c\xa5\x6c\xd3\xc9\x1a\x67\xfc\x56" \
    "\xdd\xf6\x40\x95";

static unsigned char dck_blob[] = \
    "\x30\x82\x01\xdd\x30\x82\x01\x81\xa0\x03\x02\x01\x02\x02" \
    "\x09\x00\x8a\x06\x54\x9c\x7a\xa7\xc3\x44\x30\x0c\x06\x08" \
    "\x2a\x86\x48\xce\x3d\x04\x03\x02\x05\x00\x30\x36\x31\x0b" \
    "\x30\x09\x06\x03\x55\x04\x06\x13\x02\x50\x54\x31\x0f\x30" \
    "\x0d\x06\x03\x55\x04\x0a\x0c\x06\x48\x61\x73\x6c\x61\x62" \
    "\x31\x16\x30\x14\x06\x03\x55\x04\x03\x0c\x0d\x48\x61\x73" \
    "\x6c\x61\x62\x20\x44\x65\x76\x69\x63\x65\x30\x1e\x17\x0d" \
    "\x31\x39\x31\x32\x33\x31\x32\x33\x35\x39\x35\x39\x5a\x17" \
    "\x0d\x32\x31\x31\x32\x33\x31\x32\x33\x35\x39\x35\x39\x5a" \
    "\x30\x36\x31\x0b\x30\x09\x06\x03\x55\x04\x06\x13\x02\x50" \
    "\x54\x31\x0f\x30\x0d\x06\x03\x55\x04\x0a\x0c\x06\x48\x61" \
    "\x73\x6c\x61\x62\x31\x16\x30\x14\x06\x03\x55\x04\x03\x0c" \
    "\x0d\x48\x61\x73\x6c\x61\x62\x20\x44\x65\x76\x69\x63\x65" \
    "\x30\x59\x30\x13\x06\x07\x2a\x86\x48\xce\x3d\x02\x01\x06" \
    "\x08\x2a\x86\x48\xce\x3d\x03\x01\x07\x03\x42\x00\x04\x9f" \
    "\x1d\x11\x98\xbe\xd9\x73\x6f\x5f\xe9\x2e\xde\x70\x39\x52" \
    "\x5a\xc8\x86\xaa\xc1\x2e\xc1\x99\xcc\x2e\x11\x78\x8a\xc1" \
    "\x7a\xcb\xad\xfd\x45\x94\xdd\x3a\x35\x49\xc0\x4c\x39\x49" \
    "\x11\x37\xf8\x99\xe5\x47\x11\xd7\xf7\x62\x33\xab\xcd\x7c" \
    "\x17\xa1\x18\x1b\x22\x8a\xb2\xa3\x76\x30\x74\x30\x0f\x06" \
    "\x03\x55\x1d\x13\x04\x08\x30\x06\x01\x01\xff\x02\x01\x00" \
    "\x30\x1d\x06\x03\x55\x1d\x0e\x04\x16\x04\x14\xea\x76\xd6" \
    "\xca\xe3\x8e\xd8\x1a\xa9\xae\x3b\xc9\x0c\x7b\x7a\x6b\xe6" \
    "\xfc\x14\x92\x30\x1f\x06\x03\x55\x1d\x23\x04\x18\x30\x16" \
    "\x80\x14\xea\x76\xd6\xca\xe3\x8e\xd8\x1a\xa9\xae\x3b\xc9" \
    "\x0c\x7b\x7a\x6b\xe6\xfc\x14\x92\x30\x0e\x06\x03\x55\x1d" \
    "\x0f\x01\x01\xff\x04\x04\x03\x02\x06\xc0\x30\x11\x06\x09" \
    "\x60\x86\x48\x01\x86\xf8\x42\x01\x01\x04\x04\x03\x02\x04" \
    "\x10\x30\x0c\x06\x08\x2a\x86\x48\xce\x3d\x04\x03\x02\x05" \
    "\x00\x03\x48\x00\x30\x45\x02\x21\x00\x9f\x81\x08\x21\x21" \
    "\x23\x3a\x35\x41\x9b\xc9\xa5\x12\x90\xc7\xb7\xdb\xd5\x4b" \
    "\x49\x45\x14\x8c\x57\x52\x1d\x20\x73\x7e\x30\xd8\x94\x02" \
    "\x20\x21\x25\x12\xae\x72\xf6\x1c\x8b\xf5\xd2\x1f\xb6\x5a" \
    "\x4e\x83\xde\xd3\x90\x82\xb3\xb9\x1a\x12\x1c\x5a\x64\xe9" \
    "\x4b\x4f\x5d\x51\x0c\x6c\x2e\x23\x72\xc8\xac\xec\x54\x1e" \
    "\xba\xe5\xa2\x75\x88\x13\x30\xb7\x50\x0d\x2c\xa5\x6c\xd3" \
    "\xc9\x1a\x67\xfc\x56\xdd\xf6\x40\x95";

/* 
 * Return the device certificate, used for attestation, in DER format
 */
int plat_get_device_cert(void **dc_ptr, unsigned int *dc_len){
    assert(dc_ptr != NULL);
    assert(dc_len != NULL);

    *dc_ptr = (void *)dc_der;
	*dc_len = sizeof(dc_der) - 1;

    return 0;
}

int plat_get_acc_key(void **ak_ptr, unsigned int *ak_len){
	assert(ak_ptr != NULL);
	assert(ak_len != NULL);

	*ak_ptr = (void *)ak_blob;
	*ak_len = sizeof(ak_blob) - 1;

	return 0;
}


int plat_get_dck_blob(void **dck_ptr, unsigned int *dc_len, unsigned int *ak_len){
    assert(dck_ptr != NULL);
    assert(dc_len != NULL);
	assert(ak_len != NULL);

    *dck_ptr = (void *)dck_blob;
	*dc_len = sizeof(dc_der) - 1;
	*ak_len = sizeof(ak_blob) - 1;

    return 0;
}


/* TODO
 * Update the device certificate used for attestation
 */
int plat_update_device_cert(void *hwkey, void *new_cert, unsigned int *cert_len){
    //Not implemented
    return 0;
}


