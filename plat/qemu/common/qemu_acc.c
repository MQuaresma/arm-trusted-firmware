#include <assert.h>
#include <string.h>

#include <plat/common/platform.h>
#include <platform_def.h>

static unsigned char dc_der[] = \
    "\x30\x82\x01\xd5\x30\x82\x01\x78\xa0\x03\x02\x01\x02\x02" \
    "\x00\x30\x0c\x06\x08\x2a\x86\x48\xce\x3d\x04\x03\x02\x05" \
    "\x00\x30\x36\x31\x0b\x30\x09\x06\x03\x55\x04\x06\x13\x02" \
    "\x50\x54\x31\x0f\x30\x0d\x06\x03\x55\x04\x0a\x0c\x06\x48" \
    "\x61\x73\x6c\x61\x62\x31\x16\x30\x14\x06\x03\x55\x04\x03" \
    "\x0c\x0d\x48\x61\x73\x6c\x61\x62\x20\x44\x65\x76\x69\x63" \
    "\x65\x30\x1e\x17\x0d\x31\x39\x31\x32\x33\x31\x32\x33\x35" \
    "\x39\x35\x39\x5a\x17\x0d\x32\x31\x31\x32\x33\x31\x32\x33" \
    "\x35\x39\x35\x39\x5a\x30\x36\x31\x0b\x30\x09\x06\x03\x55" \
    "\x04\x06\x13\x02\x50\x54\x31\x0f\x30\x0d\x06\x03\x55\x04" \
    "\x0a\x0c\x06\x48\x61\x73\x6c\x61\x62\x31\x16\x30\x14\x06" \
    "\x03\x55\x04\x03\x0c\x0d\x48\x61\x73\x6c\x61\x62\x20\x44" \
    "\x65\x76\x69\x63\x65\x30\x59\x30\x13\x06\x07\x2a\x86\x48" \
    "\xce\x3d\x02\x01\x06\x08\x2a\x86\x48\xce\x3d\x03\x01\x07" \
    "\x03\x42\x00\x04\xb0\xb3\xa8\xbf\x58\x18\x53\x8b\xaa\x65" \
    "\xa5\xcf\x3e\xd4\x37\xfd\x01\x82\x40\x96\xbb\x9f\x23\x8c" \
    "\xc8\x82\x28\x1e\xae\xe7\x8a\x1b\xc6\x6a\x60\x43\xec\xe9" \
    "\x2b\x96\xce\xe8\x2f\x3f\xfe\xdb\x17\xb0\xc8\x00\xd2\x23" \
    "\xf2\x38\x45\x67\x25\xd7\x23\xfb\x42\xf8\x0a\x31\xa3\x76" \
    "\x30\x74\x30\x0f\x06\x03\x55\x1d\x13\x04\x08\x30\x06\x01" \
    "\x01\xff\x02\x01\x00\x30\x1d\x06\x03\x55\x1d\x0e\x04\x16" \
    "\x04\x14\xe9\xce\x6e\xe8\x46\x17\x5a\xcd\xcf\x72\x93\x28" \
    "\x91\x55\xf2\x2f\x45\xd3\xd6\x0a\x30\x1f\x06\x03\x55\x1d" \
    "\x23\x04\x18\x30\x16\x80\x14\xe9\xce\x6e\xe8\x46\x17\x5a" \
    "\xcd\xcf\x72\x93\x28\x91\x55\xf2\x2f\x45\xd3\xd6\x0a\x30" \
    "\x0e\x06\x03\x55\x1d\x0f\x01\x01\xff\x04\x04\x03\x02\x06" \
    "\xc0\x30\x11\x06\x09\x60\x86\x48\x01\x86\xf8\x42\x01\x01" \
    "\x04\x04\x03\x02\x04\x10\x30\x0c\x06\x08\x2a\x86\x48\xce" \
    "\x3d\x04\x03\x02\x05\x00\x03\x49\x00\x30\x46\x02\x21\x00" \
    "\xb9\xea\xfb\x9e\xbe\x56\xf0\x15\xa1\xeb\x60\xaf\x40\x6e" \
    "\xa7\xad\x5b\xe2\x90\xef\x76\xf6\xde\xb8\x80\xca\x1f\x9f" \
    "\x19\x54\x84\x6c\x02\x21\x00\xa4\xf3\x8d\x58\x89\x46\x9e" \
    "\x6b\xfd\x85\x58\x6e\x25\x40\xd4\x2f\xb4\x40\xd9\x31\x7d" \
    "\x7c\x73\x43\x2c\x93\x57\x18\xf6\x3a\x4c\xe1";

static unsigned char ak_blob[] = \
	"\xf8\x3c\x31\x84\x60\x8f\xff\xf6\x7e\x63\x36\xeb\x01\xf1" \
    "\x1e\xf0\x38\xca\x77\x8b\x33\x56\x82\x13\x4f\xf9\x8b\xba" \
    "\xd9\xcf\xd0\x49";

static unsigned char dck_blob[] = \
    "\x30\x82\x01\xd5\x30\x82\x01\x78\xa0\x03\x02\x01\x02\x02" \
    "\x00\x30\x0c\x06\x08\x2a\x86\x48\xce\x3d\x04\x03\x02\x05" \
    "\x00\x30\x36\x31\x0b\x30\x09\x06\x03\x55\x04\x06\x13\x02" \
    "\x50\x54\x31\x0f\x30\x0d\x06\x03\x55\x04\x0a\x0c\x06\x48" \
    "\x61\x73\x6c\x61\x62\x31\x16\x30\x14\x06\x03\x55\x04\x03" \
    "\x0c\x0d\x48\x61\x73\x6c\x61\x62\x20\x44\x65\x76\x69\x63" \
    "\x65\x30\x1e\x17\x0d\x31\x39\x31\x32\x33\x31\x32\x33\x35" \
    "\x39\x35\x39\x5a\x17\x0d\x32\x31\x31\x32\x33\x31\x32\x33" \
    "\x35\x39\x35\x39\x5a\x30\x36\x31\x0b\x30\x09\x06\x03\x55" \
    "\x04\x06\x13\x02\x50\x54\x31\x0f\x30\x0d\x06\x03\x55\x04" \
    "\x0a\x0c\x06\x48\x61\x73\x6c\x61\x62\x31\x16\x30\x14\x06" \
    "\x03\x55\x04\x03\x0c\x0d\x48\x61\x73\x6c\x61\x62\x20\x44" \
    "\x65\x76\x69\x63\x65\x30\x59\x30\x13\x06\x07\x2a\x86\x48" \
    "\xce\x3d\x02\x01\x06\x08\x2a\x86\x48\xce\x3d\x03\x01\x07" \
    "\x03\x42\x00\x04\xb0\xb3\xa8\xbf\x58\x18\x53\x8b\xaa\x65" \
    "\xa5\xcf\x3e\xd4\x37\xfd\x01\x82\x40\x96\xbb\x9f\x23\x8c" \
    "\xc8\x82\x28\x1e\xae\xe7\x8a\x1b\xc6\x6a\x60\x43\xec\xe9" \
    "\x2b\x96\xce\xe8\x2f\x3f\xfe\xdb\x17\xb0\xc8\x00\xd2\x23" \
    "\xf2\x38\x45\x67\x25\xd7\x23\xfb\x42\xf8\x0a\x31\xa3\x76" \
    "\x30\x74\x30\x0f\x06\x03\x55\x1d\x13\x04\x08\x30\x06\x01" \
    "\x01\xff\x02\x01\x00\x30\x1d\x06\x03\x55\x1d\x0e\x04\x16" \
    "\x04\x14\xe9\xce\x6e\xe8\x46\x17\x5a\xcd\xcf\x72\x93\x28" \
    "\x91\x55\xf2\x2f\x45\xd3\xd6\x0a\x30\x1f\x06\x03\x55\x1d" \
    "\x23\x04\x18\x30\x16\x80\x14\xe9\xce\x6e\xe8\x46\x17\x5a" \
    "\xcd\xcf\x72\x93\x28\x91\x55\xf2\x2f\x45\xd3\xd6\x0a\x30" \
    "\x0e\x06\x03\x55\x1d\x0f\x01\x01\xff\x04\x04\x03\x02\x06" \
    "\xc0\x30\x11\x06\x09\x60\x86\x48\x01\x86\xf8\x42\x01\x01" \
    "\x04\x04\x03\x02\x04\x10\x30\x0c\x06\x08\x2a\x86\x48\xce" \
    "\x3d\x04\x03\x02\x05\x00\x03\x49\x00\x30\x46\x02\x21\x00" \
    "\xb9\xea\xfb\x9e\xbe\x56\xf0\x15\xa1\xeb\x60\xaf\x40\x6e" \
    "\xa7\xad\x5b\xe2\x90\xef\x76\xf6\xde\xb8\x80\xca\x1f\x9f" \
    "\x19\x54\x84\x6c\x02\x21\x00\xa4\xf3\x8d\x58\x89\x46\x9e" \
    "\x6b\xfd\x85\x58\x6e\x25\x40\xd4\x2f\xb4\x40\xd9\x31\x7d" \
    "\x7c\x73\x43\x2c\x93\x57\x18\xf6\x3a\x4c\xe1\xf8\x3c\x31" \
    "\x84\x60\x8f\xff\xf6\x7e\x63\x36\xeb\x01\xf1\x1e\xf0\x38" \
    "\xca\x77\x8b\x33\x56\x82\x13\x4f\xf9\x8b\xba\xd9\xcf\xd0" \
    "\x49";

/* 
 * Return the device certificate, used for attestation, in DER format
 */
int plat_get_device_cert(void **dc_ptr, unsigned int *dc_len){
    assert(dc_ptr != NULL);
    assert(dc_len != NULL);

    *dc_ptr = (void *)dc_der;
	*dc_len = sizeof(dc_der) - 1;

    return 0;
}

int plat_get_acc_key(void **ak_ptr, unsigned int *ak_len){
	assert(ak_ptr != NULL);
	assert(ak_len != NULL);

	*ak_ptr = (void *)ak_blob;
	*ak_len = sizeof(ak_blob) - 1;

	return 0;
}


int plat_get_dck_blob(void **dck_ptr, unsigned int *dc_len, unsigned int *ak_len){
    assert(dck_ptr != NULL);
    assert(dc_len != NULL);
	assert(ak_len != NULL);

    *dck_ptr = (void *)dck_blob;
	*dc_len = sizeof(dc_der) - 1;
	*ak_len = sizeof(ak_blob) - 1;

    return 0;
}


/* TODO
 * Update the device certificate used for attestation
 */
int plat_update_device_cert(void *hwkey, void *new_cert, unsigned int *cert_len){
    //Not implemented
    return 0;
}


